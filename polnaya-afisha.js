const events = [
  {
    id: 10,
    imageUrl: 'https://i.postimg.cc/15XxbL3F/image.png',
    imageAfisha: 'https://i.postimg.cc/VNQHDf0q/02.png',
    title: '–†–ï–ü–ò–ù: –µ–¥–∏–Ω–∏—Ü–∞ –º–æ—â–Ω–æ—Å—Ç–∏',
    date: '21 –º–∞—è, 18:30',
    venue: '–ú–∞–ª—ã–π –∑–∞–ª',
    price: '400 —Ä',
    age: '12+',
    link: './polnaya-afisha.html?id=10',
    pushkinCard: false,
    watchSlider: true,
    kassyLink: 'https://ekb.kassy.ru/events/seminary/2-64555/sections/?t=1746348293',
    odoLink: 'https://ekb.kassy.ru/events/seminary/2-64555/sections/?t=1746348293',
    description: '–ò–ª—å—è –ï—Ñ–∏–º–æ–≤–∏—á –†–µ–ø–∏–Ω (1844-1930) - —ç—Ç–æ –∏–º—è –∏–∑–≤–µ—Å—Ç–Ω–æ –∫–∞–∂–¥–æ–º—É –≤ –Ω–∞—à–µ–π —Å—Ç—Ä–∞–Ω–µ. –ó–Ω–∞–º–µ–Ω–∏—Ç—ã –∫–∞—Ä—Ç–∏–Ω—ã –ø—Ä–æ—Å–ª–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∂–∏–≤–æ–ø–∏—Å—Ü–∞: "–ë—É—Ä–ª–∞–∫–∏ –Ω–∞ –í–æ–ª–≥–µ", "–ö—Ä–µ—Å—Ç–Ω—ã–π —Ö–æ–¥ –≤ –ö—É—Ä—Å–∫–æ–π –≥—É–±–µ—Ä–Ω–∏–∏", "–ó–∞–ø–æ—Ä–æ–∂—Ü—ã –ø–∏—à—É—Ç –ø–∏—Å—å–º–æ —Ç—É—Ä–µ—Ü–∫–æ–º—É —Å—É–ª—Ç–∞–Ω—É", "–ò–≤–∞–Ω –ì—Ä–æ–∑–Ω—ã–π –∏ —Å—ã–Ω –µ–≥–æ –ò–≤–∞–Ω", –ø–æ—Ä—Ç—Ä–µ—Ç—ã –ú—É—Å–æ—Ä–≥—Å–∫–æ–≥–æ, –¢–æ–ª—Å—Ç–æ–≥–æ, –¢—Ä–µ—Ç—å—è–∫–æ–≤–∞... –í–µ–ª–∏–∫–æ–µ –Ω–∞—Å–ª–µ–¥–∏–µ —Ä—É—Å—Å–∫–æ–π –∂–∏–≤–æ–ø–∏—Å–∏! "–ê—Ö, –∂–∏–∑–Ω—å, –∂–∏–∑–Ω—å... –ß—Ç–æ —ç—Ç–æ —Ö—É–¥–æ–∂–Ω–∏–∫–∏ —Ç–∞–∫ –µ—ë –æ–±—Ö–æ–¥—è—Ç!" - –ø–∏—Å–∞–ª –æ–Ω –≤ 1881 –≥–æ–¥—É. –ú–∞—Å—à—Ç–∞–±—ã —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á "–±–æ–≥–∞—Ç—ã—Ä—è —Ä—É—Å—Å–∫–æ–≥–æ –∏—Å–∫—É—Å—Å—Ç–≤–∞" –∑–∞—Å—Ç–∞–≤–ª—è—é—Ç –∏—Å–ø—ã—Ç—ã–≤–∞—Ç—å –∏—Å–∫—Ä–µ–Ω–Ω–µ–µ –≤–æ—Å—Ö–∏—â–µ–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç—å—é —Ö—É–¥–æ–∂–Ω–∏–∫–∞, –∞ –≥–ª—É–±–∏–Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ò–ª—å—ë–π –ï—Ñ–∏–º–æ–≤–∏—á–µ–º –†–µ–ø–∏–Ω—ã–º –∂–∏–≤–æ–ø–∏—Å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –ø–æ—Ç—Ä—è—Å–∞–µ—Ç —Å–≤–æ–µ–π –º–æ—â—å—é.'
  },
  {
    id: 11,
    imageUrl: 'https://i.postimg.cc/W1RBcxgf/image.png',
    imageAfisha: 'https://i.postimg.cc/T2mjyQ66/image.png',
    title: '–î—É—à–∞',
    date: '22 –º–∞—è, 19:30',
    venue: '–ú–∞–ª—ã–π –∑–∞–ª',
    price: '–æ—Ç 800 —Ä',
    age: '16+',
    link: './polnaya-afisha.html?id=11',
    pushkinCard: false,
    watchSlider: true,
    kassyLink: 'https://ekb.kassy.ru/events/koncerty-i-shou/2-64654/',
    odoLink: 'https://ekb.kassy.ru/events/koncerty-i-shou/2-64654/',
    description: '‚ú®–ñ–∏–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: –í–∏—Ä—Ç—É–æ–∑–Ω–∞—è —Å–∫—Ä–∏–ø–∫–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –†–∞—Å—Å–∫–∞–∑–æ–≤–∞ (–ª–∏–¥–µ—Ä –≥—Ä—É–ø–ø—ã –ö—Ä–∞—Å–Ω–∞—è —Å–∫—Ä–∏–ø–∫–∞) üéª –∏ –Ω–µ–∂–Ω—ã–π —Ä–æ—è–ª—å üéπ –°–≤–µ—Ç–ª–∞–Ω—ã –°–º–∏—Ä–Ω–æ–≤–æ–π, —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –≤ –≤–∏–¥–µ –ø–µ—Å–æ—á–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏ üå™Ô∏è–æ—Ç –ï–ª–µ–Ω—ã –ö–∞–¥—ã—Ä–æ–≤–æ–π, –≤–æ–∫–∞–ª –û–ª—å–≥–∏ –°–µ–º–µ–Ω–∏—â–µ–≤–æ–π (—Å–æ–ª–∏—Å—Ç–∫–∏ –£—Ä–∞–ª–û–ø–µ—Ä–∞–ë–∞–ª–µ—Ç) ‚ú®–∏ –Ω–µ–ø—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏—è—Ç–Ω—ã–µ —Å—é—Ä–ø—Ä–∏–∑—ã –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ.üí• –í—Å–µ —ç—Ç–æ –∫–æ–Ω—Ü–µ—Ä—Ç–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–î—É—à–∞".üå∫ –ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∞—è –¥—É—à–∞ - —Å–∞–º–æ–µ –Ω–µ–∂–Ω–æ–µ –∏ —Ö—Ä—É–ø–∫–æ–µ —á—É–¥–æ –Ω–∞ —Å–≤–µ—Ç–µ. –¢–∞–∫–∞—è —Ä–∞–Ω–∏–º–∞—è, –Ω–æ —Ç–∞–∫–∞—è —Å–∏–ª—å–Ω–∞—è. –ü–æ–ª–Ω–∞—è –∑–∞–≥–∞–¥–æ–∫ –∏ —Å–µ–∫—Ä–µ—Ç–æ–≤, –∞ –∏–Ω–æ–≥–¥–∞ –æ—á–µ–Ω—å —á—É—Ç–∫–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è.'
  },
  {
    id: 12,
    imageUrl: 'https://i.postimg.cc/HkMC0vTY/image.png',
    imageAfisha: 'https://i.postimg.cc/HkMC0vTY/image.png',
    title: '–ê–Ω—Å–∞–º–±–ª—å –¢–æ–ª–æ–∫–∞',
    date: '27 –º–∞—è, 19:00',
    venue: '–ë–æ–ª—å—à–æ–π –∑–∞–ª',
    price: '–æ—Ç 1200 —Ä',
    age: '6+',
    link: './polnaya-afisha.html?id=12',
    pushkinCard: false,
    watchSlider: false,
    kassyLink: 'https://ns.show/artists/toloka',
    odoLink: 'https://ns.show/artists/toloka',
    description: '–ê–Ω—Å–∞–º–±–ª—å –¢–æ–ª√≥–∫–∞ ‚Äî —ç—Ç–æ –º–æ–ª–æ–¥—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–∏, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –Ω–∞—Å—Ç–æ—è—â–µ–π —Ä—É—Å—Å–∫–æ–π –Ω–∞—Ä–æ–¥–Ω–æ–π –º—É–∑—ã–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ–∑–¥—è—Ç –≤ —ç–∫—Å–ø–µ–¥–∏—Ü–∏–∏ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏, —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—é—Ç –∞—Ä—Ö–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –¥–∞—é—Ç –∏–º –Ω–æ–≤—É—é –∂–∏–∑–Ω—å. –ù–∞ —Å—Ü–µ–Ω–µ –≤—ã —É—Å–ª—ã—à–∏—Ç–µ —Ä–æ–¥–Ω—É—é –º—É–∑—ã–∫—É –∏–∑ —Ä–∞–∑–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π –†–æ—Å—Å–∏–∏ –≤ –∂–∏–≤–æ–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏ –∞–Ω—Å–∞–º–±–ª—è. –¢—É, —á—Ç–æ –µ—â—ë –Ω–µ–¥–∞–≤–Ω–æ –∑–≤—É—á–∞–ª–∞ –≤ –¥–æ–º–∞—Ö –≤–∞—à–∏—Ö –±–∞–±—É—à–µ–∫ –∏ –¥–µ–¥—É—à–µ–∫, –Ω–∞ —Å–≤–∞–¥—å–±–∞—Ö –∏ –≤–æ –≤—Ä–µ–º—è –∑–∞—Å—Ç–æ–ª—å—è. –ù–µ —É–ø—É—Å—Ç–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å —Ä–æ–¥–Ω–æ–π –∫—É–ª—å—Ç—É—Ä–æ–π.'
  },
  {
    id: 13,
    imageUrl: 'https://i.postimg.cc/j5BNtVrj/image.png',
    imageAfisha: 'https://i.postimg.cc/fb1s7gvM/image.png',
    title: '–û —á–µ–º –º–æ–ª—á–∏—Ç –∂–µ–Ω—â–∏–Ω–∞',
    date: '19 –∏—é–Ω—è, 19:00',
    venue: '–ê—Ä—Ç-–•–æ–ª–ª ¬´–ú–∞–ª—ã–π –∑–∞–ª¬ª',
    price: '–æ—Ç 500 —Ä',
    age: '18+',
    link: './polnaya-afisha.html?id=13',
    pushkinCard: false,
    watchSlider: true,
    kassyLink: 'https://ekb.kassy.ru/events/koncerty-i-shou/2-64710/',
    odoLink: 'https://ekb.kassy.ru/events/koncerty-i-shou/2-64710/',
    description: '–°–í–ï–¢–õ–ê–ù–ê –ö–û–¢–û–í–ê –≤ –∫–æ–Ω—Ü–µ—Ä—Ç–µ –∑–∞ —Å—Ç–æ–ª–∏–∫–∞–º–∏ "–û —á–µ–º –º–æ–ª—á–∏—Ç –∂–µ–Ω—â–∏–Ω–∞". –ü–æ–≤–æ–¥–æ–≤ –¥–ª—è –º–æ–ª—á–∞–Ω–∏—è –∂–µ–Ω—â–∏–Ω—ã ... –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –û –ª—é–±–≤–∏ –∏ —Ä–∞–∑–ª—É–∫–µ, –æ —Ä–∞–¥–æ—Å—Ç–∏ –∏ –Ω–µ—É–¥–∞—á–µ, –æ –º–µ—á—Ç–∞—Ö –∏ —á–∞—è–Ω–∏—è—Ö... –ñ–µ–Ω—â–∏–Ω–∞ –º–æ–ª—á–∏—Ç. –ù–µ—Ç! –ñ–µ–Ω—â–∏–Ω–∞ –ø–æ—ë—Ç! ‚úì –õ—é–±–∏–º—ã–µ –ø–µ—Å–Ω–∏ –≤ –Ω–æ–≤–æ–º –ø—Ä–æ—á—Ç–µ–Ω–∏–∏; ‚úì –†–∞–∑–≥–æ–≤–æ—Ä—ã –æ –ª–∏—á–Ω–æ–º; ‚úì –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –≥–∏—Ç–∞—Ä–∞ –†–û–ú–ê–ù–ê –ì–£–°–ï–í–ê. –ü—Ä–∏—Ö–æ–¥–∏—Ç–µ! –î–∞–≤–∞–π—Ç–µ –≤–º–µ—Å—Ç–µ —É—Å–ª—ã—à–∏–º, –æ —á–µ–º –º–æ–ª—á–∏—Ç –∂–µ–Ω—â–∏–Ω–∞.'
  }
];

function parseDate(dateStr) {
  const [dayMonth, time] = dateStr.split(', ');
  const [day, month] = dayMonth.split(' ');
  const monthIndex = ['—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è', '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'].indexOf(month.toLowerCase());
  const [hours, minutes] = time.split(':');
  const year = 2025;
  return new Date(year, monthIndex, parseInt(day), parseInt(hours), parseInt(minutes));
}

function getDayOfWeek(dateStr) {
  const [dayMonth, time] = dateStr.split(', ');
  const [day, month] = dayMonth.split(' ');
  const monthIndex = ['—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è', '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'].indexOf(month.toLowerCase());
  const date = new Date(2025, monthIndex, parseInt(day));
  const days = ['–≤—Å', '–ø–Ω', '–≤—Ç', '—Å—Ä', '—á—Ç', '–ø—Ç', '—Å–±'];
  return days[date.getDay()];
}

function sortEventsByDate(eventsArray) {
  return [...eventsArray].sort((a, b) => {
    const dateA = parseDate(a.date);
    const dateB = parseDate(b.date);
    return dateA - dateB;
  });
}

function renderAfishaCards() {
  const cardsContainer = document.getElementById('cards');
  if (!cardsContainer) {
    console.warn('Cards container not found');
    return;
  }

  const sortedEvents = sortEventsByDate(events);
  
  sortedEvents.forEach(slide => {
    console.log('Rendering card with link:', slide.link);
    const [dayMonth, time] = slide.date.split(', ');
    const dayOfWeek = getDayOfWeek(slide.date);
    const card = document.createElement('a');
    card.className = 'card';
    card.href = slide.link;
    card.innerHTML = `
      <div class="card-image" style="background-image: url(${slide.imageAfisha || 'https://i.postimg.cc/k5PW2SHr/afisha-zaglushka.jpg'})">
        <div class="age-badge">${slide.age}</div>
        <div class="price-badge">${slide.price}</div>
        ${slide.pushkinCard ? `
          <div class="pushkin-badge">
            <img src="assets/svg_icons/pushkin.png" class="pushkin-icon" alt="Pushkin Card">
          </div>
        ` : ''}
      </div>
      <div class="card-info">
        <div class="card-title">${slide.title}</div>
        <div class="card-date">
          <span>${dayMonth}, ${dayOfWeek}</span>
          <div class="date-dot"></div>
          <span>${time}</span>
        </div>
        <div class="card-venue">${slide.venue}</div>
      </div>
    `;
    card.addEventListener('click', (e) => {
      console.log('Card clicked, navigating to:', card.href);
    });
    cardsContainer.appendChild(card);
  });
}

function initSlider() {
  const cardsContainer = document.querySelector('.cards');
  if (!cardsContainer) {
    console.warn('Cards container not found for slider');
    return;
  }

  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–ª–∏–∫–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–≤–∞–π–ø–æ–≤ –∫–∞–∫ –∫–ª–∏–∫–æ–≤
  cardsContainer.addEventListener('click', (event) => {
    const card = event.target.closest('.card');
    if (card && card.href) {
      event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–ª–∏–∫
      window.location.href = card.href; // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ —Å—Å—ã–ª–∫–µ
    }
  });

  // –û—Ç–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
  cardsContainer.addEventListener('contextmenu', (event) => {
    event.preventDefault();
  });
}

function getEventById(id) {
  return events.find(event => event.id === parseInt(id));
}

function renderEventDetails() {
  // –í—ã–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ polnaya-afisha.html
  if (!window.location.pathname.includes('polnaya-afisha.html')) {
    return;
  }

  const urlParams = new URLSearchParams(window.location.search);
  const eventId = urlParams.get('id');
  const event = getEventById(eventId);

  console.log('Extracted eventId:', eventId);
  console.log('Found event:', event);

  if (!event) {
    const section = document.querySelector('.events-detail-section');
    if (section) {
      section.innerHTML = '<p>–°–æ–±—ã—Ç–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
    }
    return;
  }

  document.querySelector('.event-image').src = event.imageAfisha;
  document.querySelector('.age-badge').textContent = event.age;
  document.querySelector('.event-title').textContent = event.title;
  document.querySelector('.event-button').href = event.odoLink;
  document.querySelector('.details-item:nth-child(1)').innerHTML = `<span class="details-label">–î–∞—Ç–∞:</span> ${event.date.split(', ')[0]}`;
  document.querySelector('.details-item:nth-child(2)').innerHTML = `<span class="details-label">–í—Ä–µ–º—è:</span> ${event.date.split(', ')[1]}`;
  document.querySelector('.details-item:nth-child(3) .details-link').textContent = event.venue;
  document.querySelector('.details-item:nth-child(4)').innerHTML = `<span class="details-label">–¶–µ–Ω–∞:</span> ${event.price}`;
  document.querySelector('.ticket-button').href = event.kassyLink;
  document.querySelector('.event-description p').textContent = event.description;
}

// –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è zalyManager
const zalyManager = {
  initZaly: () => {
    console.log('zalyManager.initZaly() called (placeholder)');
  }
};

// –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è manager (—Å–ª–∞–π–¥–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ slider/manager.js)
const manager = {
  initSlider: () => {
    console.log('manager.initSlider() called (placeholder)');
  }
};

document.addEventListener('DOMContentLoaded', () => {
  renderAfishaCards();
  initSlider();
  renderEventDetails();
});

export { events, sortEventsByDate, renderAfishaCards, manager, zalyManager };